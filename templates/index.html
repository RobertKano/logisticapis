<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Security-Policy" content="block-all-mixed-content">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <title>
    {% if is_dev %}
        üöß [DEV] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¢–ö
    {% else %}
        –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–∏—Å—Ç–∏–∫–∏ | –Æ–∂–Ω—ã–π –§–æ—Ä–ø–æ—Å—Ç
    {% endif %}
</title>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">

    <link href="{{ url_for('static', filename='css/style.css') }}{% if is_dev %}?v={{ range(1, 999) | random }}{% else %}?v=1.3{% endif %}" rel="stylesheet">

    <style>
        .status-indicator, .status-pulse {
            background-color: {% if is_dev %}var(--dev-orange){% else %}var(--success-green){% endif %};
        }
    </style>

</head>

<body class="bg-light">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <div class="d-flex align-items-center">
                    <div class="status-indicator" id="api-status"><div class="status-pulse"></div></div>
                    <h4 class="m-0 fw-bold">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–∏—Å—Ç–∏–∫–∏</h4>
                </div>
                <small class="text-muted">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: <span id="update-time">‚Äî</span></small>
            </div>
            {% if is_dev %}
                <div class="badge bg-warning text-dark ms-3 shadow-sm"
                      style="font-size: 1.7rem; border: 2px solid #d97706;">
                    üöß DEV-MODE (Port 5001)
                </div>
            {% endif %}
            <button onclick="loadReportData()" class="btn btn-sm btn-brand px-4 shadow-sm" id="refresh-btn">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        </div>

        <!-- –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ (–¢–æ–ª—å–∫–æ –¥–ª—è DEV —Ä–µ–∂–∏–º–∞) -->
        {% if is_dev %}
        <div class="container-fluid mb-4" id="admin-marker">
            <div class="card border-0 shadow-sm" style="border-radius: 12px; background: #fdfdfd; border-left: 5px solid #6366f1 !important;">
                <div class="card-body p-3">
                    <h6 class="fw-bold mb-3 text-indigo" id="m_form_title">üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∫–æ–π (–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)</h6>
                    <!-- –î–æ–±–∞–≤–∏–ª gx-1 –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –æ—Ç—Å—Ç—É–ø–æ–≤ –º–µ–∂–¥—É –∫–æ–ª–æ–Ω–∫–∞–º–∏ -->
                    <div class="row gx-1 gy-2">
                        <input type="hidden" id="m_edit_id">

                        <div class="col-md-1">
                            <input type="text" id="m_id" class="form-control form-control-sm" placeholder="‚Ññ">
                        </div>
                        <div class="col-md-2">
                            <input type="text" id="m_sender" class="form-control form-control-sm" placeholder="–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å">
                        </div>
                        <!-- –ú–∞—Ä—à—Ä—É—Ç -->
                        <div class="col-md-2">
                            <div class="input-group input-group-sm">
                                <input type="text" id="m_route_from" class="form-control" placeholder="–û—Ç–∫—É–¥–∞">
                                <span class="input-group-text px-1" style="background: #fff;">‚û°Ô∏è</span>
                                <input type="text" id="m_route_to" class="form-control" placeholder="–ö—É–¥–∞">
                            </div>
                        </div>
                        <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã -->
                        <div class="col-md-2">
                            <div class="input-group input-group-sm">
                                <input type="text" id="m_p_m" class="form-control" placeholder="–ú">
                                <input type="text" id="m_p_w" class="form-control" placeholder="–ö–≥">
                                <input type="text" id="m_p_v" class="form-control" placeholder="–ú3">
                            </div>
                        </div>
                        <!-- –°—Ç–∞—Ç—É—Å: —É–∂–∞–ª –¥–æ col-md-2 -->
                        <div class="col-md-2">
                            <select id="m_status" class="form-control form-control-sm" style="cursor: pointer;">
                                <option value="–û–∂–∏–¥–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏">üïí –û–∂–∏–¥–∞–µ—Ç</option>
                                <option value="–í –ø—É—Ç–∏">üöö –í –ø—É—Ç–∏</option>
                                <option value="–ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ">‚úÖ –ì–æ—Ç–æ–≤</option>
                                <option value="–í—ã–¥–∞–Ω (–≤ –∞—Ä—Ö–∏–≤)">üì¶ –í –ê–†–•–ò–í</option>
                            </select>
                        </div>
                        <!-- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —É–∂–∞–ª –¥–æ col-md-2 -->
                        <div class="col-md-2">
                            <select id="m_priority" class="form-control form-control-sm" style="cursor: pointer;">
                                <option value="low">‚ö™ –û–±—ã—á–Ω—ã–π</option>
                                <option value="medium">üü° –í–∞–∂–Ω—ã–π</option>
                                <option value="high">üî¥ –°–†–û–ß–ù–û</option>
                            </select>
                        </div>
                        <!-- –ö–Ω–æ–ø–∫–∞: —Ç–µ–ø–µ—Ä—å —Ç–æ—á–Ω–æ –≤–ª–µ–∑–µ—Ç –≤ –æ—Å—Ç–∞–≤—à—É—é—Å—è 1 –∫–æ–ª–æ–Ω–∫—É -->
                        <div class="col-md-1">
                            <button id="m_btn_save" onclick="saveManualCargo()" class="btn btn-indigo btn-sm w-100 fw-bold">OK</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <style>
            .text-indigo { color: #6366f1; }
            .btn-indigo { background: #6366f1; color: white; border: none; }
            .btn-indigo:hover { background: #4f46e5; color: white; }
            .form-control-sm { height: 31px; }
            /* –î–æ–ø. —Ñ–∏–∫—Å, —á—Ç–æ–±—ã –∏–Ω–ø—É—Ç—ã –Ω–µ —Ä–∞—Å–ø–∏—Ä–∞–ª–æ */
            .input-group-text { font-size: 0.75rem; }
        </style>
        {% endif %}


        <!-- –ö–ê–†–¢–û–ß–ö–ò –°–¢–ê–¢–ò–°–¢–ò–ö–ò -->
        <div class="row g-3 mb-4">
            <div class="col-6 col-md-3">
                <div class="stat-card clickable-stat" onclick="filterByStat('total', this)">
                    <div class="stat-label">–í—Å–µ–≥–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö</div>
                    <div class="stat-value text-dark" id="stat-total">0</div>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="stat-card clickable-stat" style="border-top: 4px solid var(--success-green);" onclick="filterByStat('ready', this)">
                    <div class="stat-label">–ì–æ—Ç–æ–≤–æ –∫ –∑–∞–±–æ—Ä—É</div>
                    <div class="stat-value text-success" id="stat-ready">0</div>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="stat-card clickable-stat" style="border-top: 4px solid var(--accent-blue);" onclick="filterByStat('transit', this)">
                    <div class="stat-label">–í –ø—É—Ç–∏</div>
                    <div class="stat-value text-primary" id="stat-transit">0</div>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="stat-card clickable-stat" style="border-top: 4px solid #ef4444;" onclick="filterByStat('debt', this)">
                    <div class="stat-label">–û–∂–∏–¥–∞—é—Ç –æ–ø–ª–∞—Ç—ã</div>
                    <div class="stat-value text-danger" id="stat-debt">0</div>
                </div>
            </div>
        </div>

        <!-- –§–ò–õ–¨–¢–†–´ –ò –ü–û–ò–°–ö -->
        <div class="row gx-2 gy-3 mb-4 align-items-center">
            <!-- –ü–æ–∏—Å–∫: 6 –∫–æ–ª–æ–Ω–æ–∫ -->
            <div class="col-md-6">
                <div class="position-relative">
                    <input type="text" id="searchInput" class="form-control border-0 shadow-sm"
                           style="border-radius: 12px; padding: 12px 20px; height: 48px;"
                           placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∫–ª–∞–¥–Ω–æ–π, –¢–ö –∏–ª–∏ –≥–æ—Ä–æ–¥—É...">
                    <span id="clearSearch" class="position-absolute" style="right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #94a3b8; display: none; font-size: 1.2rem;">&times;</span>
                </div>
            </div>

            <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∏ –ø—Ä–µ—Å–µ—Ç—ã: 3 –∫–æ–ª–æ–Ω–∫–∏ -->
            <div class="col-md-3">
                <div class="custom-filter-group">
                    <span class="ms-1">üìÖ</span>
                    <input type="date" id="dateFilter" class="form-control form-control-sm" style="width: 100px; font-size: 0.75rem;">
                    <div class="vr mx-1" style="height: 16px; opacity: 0.1;"></div>
                    <button class="btn btn-quick" onclick="quickDateFilter('week')">7–¥</button>
                    <button class="btn btn-quick" onclick="quickDateFilter('month')">30–¥</button>
                </div>
            </div>

            <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å: 3 –∫–æ–ª–æ–Ω–∫–∏ -->
            <div class="col-md-3 text-md-end">
                <div class="segment-control shadow-sm">
                    <button class="btn active" id="btn-active" onclick="setView('active')">
                        –ê–∫—Ç–∏–≤ <span class="badge" id="count-active">0</span>
                    </button>
                    <button class="btn" id="btn-archive" onclick="setView('archive')">
                        –ê—Ä—Ö–∏–≤ <span class="badge" id="count-archive">0</span>
                    </button>
                </div>
            </div>
        </div>



        <!-- –¢–ê–ë–õ–ò–¶–ê -->
        <div class="table-container">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>–¢–ö</th>
                        <th>‚Ññ –ù–∞–∫–ª–∞–¥–Ω–æ–π</th>
                        <th>–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å</th>
                        <th>–ü–æ–ª—É—á–∞—Ç–µ–ª—å</th>
                        <th>–ú–∞—Ä—à—Ä—É—Ç</th>
                        <th>–ì—Ä—É–∑</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th onclick="toggleSort()" style="cursor: pointer; user-select: none;">
                            –ü—Ä–∏–±—ã—Ç–∏–µ <span id="sort-icon">üîΩ</span>
                        </th>
                        <th>–û–ø–ª–∞—Ç–∞</th>
                    </tr>
                </thead>
                <tbody id="report-table-body"></tbody>
            </table>
        </div>
    </div>

   <footer class="container-fluid mt-5 mb-4">
        <div class="row border-top pt-4 align-items-center">
            <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –∫–æ–ø–∏—Ä–∞–π—Ç -->
            <div class="col-md-5 text-muted small text-center text-md-start">
                ¬© 2024-2026 <strong>LogisticAPIs Service</strong><br>
                <span style="opacity: 0.7;">–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ v1.2.0</span>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: —Å—Å—ã–ª–∫–∏ –∏ –∫–Ω–æ–ø–∫–∞ -->
            <div class="col-md-7 mt-3 mt-md-0">
                <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-end" style="gap: 1.5rem;">
                    <a href="/docs/" class="text-muted small text-decoration-underline" target="_blank">
                        API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
                    </a>
                    <a href="https://github.com/RobertKano/logisticapis/tree/main" class="text-muted small text-decoration-underline" target="_blank">
                        –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
                    </a>
                    <a href="https://yoomoney.ru/to/4100119466723517"
                       target="_blank"
                       class="btn btn-sm text-white px-3"
                       style="background-color: #725dff; border-radius: 10px; font-weight: 500; white-space: nowrap; box-shadow: 0 4px 10px rgba(114, 93, 255, 0.2);">
                        ‚òï –ü–æ–¥–∞—Ä–∏—Ç—å –∫–æ—Ñ–µ
                    </a>
                </div>
            </div>
        </div>

        <div class="text-center mt-4" style="opacity: 0.5;">
            <small class="text-muted" style="font-size: 0.7rem;">
                Developed with ‚ù§Ô∏è by RobertKano
            </small>
        </div>
    </footer>

    <div id="print-zone" class="d-none d-print-block">
        <h2 style="text-align: center; margin-bottom: 10px;">–í–ï–î–û–ú–û–°–¢–¨ –ü–†–ò–ï–ú–ö–ò –ì–†–£–ó–û–í</h2>
        <p style="text-align: center; font-size: 10pt; margin-bottom: 20px;">–î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è: <span id="print-date"></span></p>

        <table style="width: 100%; border-collapse: collapse; font-family: 'Segoe UI', Arial, sans-serif; table-layout: fixed;">
            <thead>
                <tr style="background: #f0f0f0;">
                    <th style="border: 2px solid #000; padding: 10px; width: 12%;">–¢–ö</th>
                    <th style="border: 2px solid #000; padding: 10px; width: 35%;">–û–¢–ü–†–ê–í–ò–¢–ï–õ–¨</th>
                    <th style="border: 2px solid #000; padding: 10px; width: 20%;">–ü–ê–†–ê–ú–ï–¢–†–´</th>
                    <th style="border: 2px solid #000; padding: 10px; width: 8%;">–ü–†–ò–ù–Ø–¢–û</th>
                    <th style="border: 2px solid #000; padding: 10px; width: 25%;">–ü–†–ò–ú–ï–ß–ê–ù–ò–ï / –ë–†–ê–ö</th>
                </tr>
            </thead>
            <tbody id="print-table-body">
                <!-- –î–∞–Ω–Ω—ã–µ –∏–∑ JS -->
            </tbody>
        </table>

        <div style="margin-top: 30px; display: flex; justify-content: space-between; font-size: 11pt;">
            <div>–°–¥–∞–ª (–≤–æ–¥–∏—Ç–µ–ª—å): _________________</div>
            <div>–ü—Ä–∏–Ω—è–ª (–∫–ª–∞–¥–æ–≤—â–∏–∫): _________________</div>
        </div>
    </div>



    <!-- –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –°–ö–†–ò–ü–¢–û–í -->
    <script src="{{ url_for('static', filename='js/main.js') }}{% if is_dev %}?v={{ range(1, 999) | random }}{% else %}?v=1.4{% endif %}"></script>
</body>
</html>

